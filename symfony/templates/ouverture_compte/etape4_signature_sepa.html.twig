{% extends 'base.html.twig' %}

{% block title %}Hello OuvertureCompteController!{% endblock %}

{% block body %}
    <div class="container">
        <div style="width: 80%">
            <div>{{ "ETAPE 4/5" | trans }}</div>
            <h1 class="mb-3">{{ "Change automatique" | trans }}</h1>
        </div>

        {% if webHook != 0 %}
        <iframe src="https://staging-app.yousign.com/procedure/sign?members={{ memberToken }}" width="100%" height="700px"> </iframe>
        {% else %}
            <br />
            <br />
            <br />
            <br />
            <div class="text-center">
                <a class="btn btn-outline-primary" href="{{ path('ouverture_compte_signature_sepa') }}"> Recharger la page </a>
            </div>
        {% endif %}

    </div>
{% endblock %}


{% block js %}
    <script type="text/javascript">

        $( document ).ready(function() {
            var tid = setInterval(ajaxCall, 5000);
            function ajaxCall() {
                $.ajax({
                        method: "POST",
                        url: "{{ path('ajax_yousign_webhook') }}",
                        data: { name: {{ webHook }} }
                    })
                    .done(function( msg ) {
                        if(msg === 'ok'){
                            abortTimer();
                            window.location.href='{{ path('app_compte_etape5_securite') }}';
                        } else {
                            console.log('pas bon');
                        }
                    });
            }
            function abortTimer() {
                clearInterval(tid);
            }


        });


    </script>
{% endblock %}
