{% extends 'base.html.twig' %}

{% form_theme form 'bootstrap_4_layout.html.twig' %}

{% block title %}{{ title | trans }}{% endblock %}


{% block css %}
    <style type="text/css">
        @keyframes ldio-x8uv5a6ulc {
            0% { opacity: 1 }
            100% { opacity: 0 }
        }
        .ldio-x8uv5a6ulc div {
            left: 94px;
            top: 48px;
            position: absolute;
            animation: ldio-x8uv5a6ulc linear 1.408450704225352s infinite;
            background: #346c85;
            width: 12px;
            height: 24px;
            border-radius: 4.08px / 4.08px;
            transform-origin: 6px 52px;
        }.ldio-x8uv5a6ulc div:nth-child(1) {
             transform: rotate(0deg);
             animation-delay: -1.2910798122065725s;
             background: #346c85;
         }.ldio-x8uv5a6ulc div:nth-child(2) {
              transform: rotate(30deg);
              animation-delay: -1.1737089201877933s;
              background: #346c85;
          }.ldio-x8uv5a6ulc div:nth-child(3) {
               transform: rotate(60deg);
               animation-delay: -1.056338028169014s;
               background: #346c85;
           }.ldio-x8uv5a6ulc div:nth-child(4) {
                transform: rotate(90deg);
                animation-delay: -0.9389671361502346s;
                background: #346c85;
            }.ldio-x8uv5a6ulc div:nth-child(5) {
                 transform: rotate(120deg);
                 animation-delay: -0.8215962441314553s;
                 background: #346c85;
             }.ldio-x8uv5a6ulc div:nth-child(6) {
                  transform: rotate(150deg);
                  animation-delay: -0.7042253521126759s;
                  background: #346c85;
              }.ldio-x8uv5a6ulc div:nth-child(7) {
                   transform: rotate(180deg);
                   animation-delay: -0.5868544600938966s;
                   background: #346c85;
               }.ldio-x8uv5a6ulc div:nth-child(8) {
                    transform: rotate(210deg);
                    animation-delay: -0.4694835680751173s;
                    background: #346c85;
                }.ldio-x8uv5a6ulc div:nth-child(9) {
                     transform: rotate(240deg);
                     animation-delay: -0.35211267605633795s;
                     background: #346c85;
                 }.ldio-x8uv5a6ulc div:nth-child(10) {
                      transform: rotate(270deg);
                      animation-delay: -0.23474178403755866s;
                      background: #346c85;
                  }.ldio-x8uv5a6ulc div:nth-child(11) {
                       transform: rotate(300deg);
                       animation-delay: -0.11737089201877933s;
                       background: #346c85;
                   }.ldio-x8uv5a6ulc div:nth-child(12) {
                        transform: rotate(330deg);
                        animation-delay: 0s;
                        background: #346c85;
                    }
        .loadingio-spinner-spinner-3n6a06i025x {
            width: 200px;
            height: 200px;
            display: inline-block;
            overflow: hidden;
            background: #ffffff;
        }
        .ldio-x8uv5a6ulc {
            width: 100%;
            height: 100%;
            position: relative;
            transform: translateZ(0) scale(1);
            backface-visibility: hidden;
            transform-origin: 0 0; /* see note above */
        }
        .ldio-x8uv5a6ulc div { box-sizing: content-box; }
        /* generated by https://loading.io/ */
    </style>
{% endblock %}

{% block body %}
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-6 offset-md-3 mt-4">
                <div class="mt-md-4">
                    <div style="">
                        <div>{{ "ETAPE 3/4" | trans }}</div>
                        <h1 class="mb-3">{{ title | trans }}</h1>
                        <p class="text-subtitle">{{ "Afin de valider votre compte, la régulation bancaire nous impose de vérifier une pièce d'identité.<br /><br />
                        Vous pouvez importer un scan ou une photo de votre <b>carte d'identité</b> ou de votre <b>passeport</b> : <br /><br />
                        - Le document ne doit pas être flou <br />
                        - Votre photo doit apparaître sur le document <br />
                        " | trans | raw }}</p>


                        <div id="spinner" class="text-center mt-4 d-none">
                            <div class="loadingio-spinner-spinner-3n6a06i025x"><div class="ldio-x8uv5a6ulc">
                                    <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                                </div></div>

                            <p>{{ "la vérification de votre pièce d'identité peut prendre jusqu'à dix secondes." }}</p>
                        </div>

                        <div id="formulaire">
                            <div style="margin-top: 50px" class="text-center">
                                <img src="{{ asset('images/idcard.png') }}" width="100px" />
                            </div>

                            <div class="mt-2">
                                <form id="myform" action="{{ path('app_vee_api_idcheck') }}" method="post">
                                    <div class="form-group">
                                        <label for="form_idcard"> {{ "Importer votre pièce d'identité" | trans }}</label>
                                        <div class="custom-file">
                                            <input type="file" id="form_idcard" name="form[idcard]" aria-describedby="form_idcard_help" class="custom-file-input" lang="{{ app.request.locale }}">
                                            <label for="form_idcard" class="custom-file-label"> </label>
                                        </div>
                                        <small id="form_idcard_help" class="form-text text-muted">{{ "Au format .jpg .png ou .pdf, maximum 4 Mo" | trans }}</small>
                                    </div>

                                    <div class="form-group">
                                        <input type="submit" class="btn btn-outline-primary" value="{{ "Valider" | trans }}">
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}


{% block js %}
    <script type="text/javascript">

        document.querySelector('.custom-file-input').addEventListener('change',function(e){
            var fileName = document.getElementById("form_idcard").files[0].name;
            var nextSibling = e.target.nextElementSibling
            nextSibling.innerText = fileName
        })

        $(document).ready(function() {

            $('#myform').submit(function (e){
                $('#formulaire').hide();
                $('#spinner').removeClass('d-none');
                e.preventDefault();
                e.stopImmediatePropagation();

                var form = $(this);
                var formdata = false;
                if (window.FormData){
                    formdata = new FormData(form[0]);
                }

                var formAction = form.attr('action');
                $.ajax({
                    url         : formAction,
                    data        : formdata ? formdata : form.serialize(),
                    cache       : false,
                    contentType : false,
                    processData : false,
                    type        : 'POST',
                    success     : function(data, textStatus, jqXHR){
                        if(data.bool){
                            window.location.href = '{{ path('app_vee_etape4_success') }}';
                        } else {
                            document.location.reload(true);
                        }
                    }
                });
                return false;
            });
        });
    </script>
{% endblock %}

